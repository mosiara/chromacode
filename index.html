<!--
ChromaCode -  Visual-first image-to-code generator with color intelligence

Copyright (C) 2025 Edna Nyangau

This file is part of ChromaCode.
Dual licensed under AGPL-3.0 and Commercial License.
See LICENSE file for complete terms.

For commercial licensing: license@chromacode.dev
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChromaCode‚Ñ¢ - Visual-First Layout Language</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #581c87 0%, #1e3a8a 50%, #312e81 100%);
            min-height: 100vh;
            color: white;
        }

        .header {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px;
        }

        .header-content {
            max-width: 1280px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .title {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(to right, #f472b6, #06b6d4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 0.875rem;
            color: #d1d5db;
            margin-top: 4px;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .btn-export {
            background: #10b981;
        }

        .btn-export:hover {
            background: #059669;
        }

        .btn-export:disabled {
            background: #6b7280;
            cursor: not-allowed;
        }

        #fileInput {
            display: none;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 24px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-group {
            margin-bottom: 16px;
        }

        .control-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .range-input {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
        }

        .range-input::-webkit-slider-thumb {
            -webkit-appearance-webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #06b6d4;
            cursor: pointer;
        }

        .range-input::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #06b6d4;
            cursor: pointer;
            border: none;
        }

        .mode-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .mode-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .mode-title {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .mode-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.2;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .color-swatch {
            position: relative;
            width: 48px;
            height: 48px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .color-tooltip {
            position: absolute;
            top: -32px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
            white-space: nowrap;
            pointer-events: none;
        }

        .color-swatch:hover .color-tooltip {
            opacity: 1;
        }

        .canvas-container {
            position: relative;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 4/3;
        }

        .canvas {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .overlay {
            position: absolute;
            inset: 0;
        }

        .grid-cell {
            position: absolute;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .grid-cell.interactive {
            cursor: pointer;
        }

        .grid-cell.interactive:hover {
            border-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            background: rgba(255, 255, 255, 0.1);
        }

        .grid-cell.background {
            border: 1px solid rgba(255, 255, 255, 0.2);
            pointer-events: none;
        }

        .cell-indicator {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .grid-cell:hover .cell-indicator {
            opacity: 1;
        }

        .cell-coords {
            position: absolute;
            top: 4px;
            left: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .grid-cell:hover .cell-coords {
            opacity: 1;
        }

        .canvas-info {
            margin-top: 16px;
            text-align: center;
            font-size: 0.875rem;
            color: #d1d5db;
        }

        .export-preview {
            margin-top: 24px;
        }

        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: #10f78a;
            max-height: 240px;
            overflow: auto;
            white-space: pre-wrap;
        }

        .selected-cell-info {
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            font-size: 0.875rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }
            
            .header-buttons {
                justify-content: center;
            }
        }

        .icon {
            width: 18px;
            height: 18px;
            display: inline-block;
            vertical-align: middle;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #06b6d4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div>
                <h1 class="title">ChromaCode‚Ñ¢</h1>
                <p class="subtitle">Visual-first color-intelligent language from image to code</p>
            </div>
            <div class="header-buttons">
                <label class="btn" for="fileInput">
                    <span class="icon">üì§</span>
                    Upload Image
                </label>
                <input type="file" id="fileInput" accept="image/*" onchange="handleImageUpload(event)">
                <button class="btn btn-export" id="exportBtn" onclick="downloadExport()" disabled>
                    <span class="icon">üíæ</span>
                    <span id="exportBtnText">Export .chromacode.json</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Mode Selection -->
            <div class="card">
                <h3 class="card-title">
                    <span class="icon">üéØ</span>
                    Choose Your Mode
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <button class="mode-btn" id="staticBtn" onclick="setMode('background')">
                        <div class="mode-icon">üñºÔ∏è</div>
                        <div class="mode-title">Static Grid</div>
                        <div class="mode-desc">Clean background overlay + CSS/HTML/JS code</div>
                    </button>
                    
                    <button class="mode-btn active" id="interactiveBtn" onclick="setMode('interactive')">
                        <div class="mode-icon">‚ö°</div>
                        <div class="mode-title">Interactive</div>
                        <div class="mode-desc">Clickable zones + JSON export</div>
                    </button>
                </div>
            </div>

            <!-- Grid Settings -->
            <div class="card">
                <h3 class="card-title">
                    <span class="icon">‚öôÔ∏è</span>
                    Grid Settings
                </h3>
                
                <div class="control-group">
                    <label class="control-label">Grid Size: <span id="gridSizeLabel">4√ó4</span></label>
                    <input type="range" class="range-input" id="gridSize" min="2" max="12" value="4" onchange="updateGridSize()">
                </div>
                
                <div class="control-group" id="toleranceControl">
                    <label class="control-label">Color Tolerance: <span id="toleranceLabel">15%</span></label>
                    <input type="range" class="range-input" id="colorTolerance" min="5" max="50" value="15" onchange="updateTolerance()">
                </div>
            </div>

            <!-- Color Palette -->
            <div class="card" id="paletteCard">
                <h3 class="card-title">
                    <span class="icon">üé®</span>
                    Extracted Palette
                </h3>
                <div class="palette-grid" id="paletteGrid">
                    <!-- Colors will be populated here -->
                </div>
            </div>

            <!-- Selected Cell Info -->
            <div class="card" id="cellInfoCard" style="display: none;">
                <h3 class="card-title">
                    <span class="icon">‚ö°</span>
                    Zone Info
                </h3>
                <div class="selected-cell-info" id="cellInfo">
                    <!-- Cell info will be populated here -->
                </div>
            </div>
        </div>

        <!-- Main Canvas -->
        <div>
            <div class="card">
                <h3 class="card-title">
                    <span class="icon">üëÅÔ∏è</span>
                    Interactive Canvas
                </h3>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Processing image...</p>
                </div>
                
                <div class="canvas-container" id="canvasContainer">
                    <canvas class="canvas" id="canvas"></canvas>
                    <div class="overlay" id="overlay"></div>
                </div>
                
                <div class="checkbox-container" style="margin-top: 16px; justify-content: center;">
                    <input type="checkbox" class="checkbox" id="showOverlay" checked onchange="toggleOverlay()">
                    <label for="showOverlay" class="control-label" style="margin: 0;">Show Grid Overlay</label>
                </div>
                
                <div class="canvas-info">
                    <p id="canvasStats">"Loading demo image..."</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Preview -->
    <div class="export-preview" id="exportPreview" style="display: none;">
        <div class="container">
            <div class="card">
                <h3 class="card-title">ChromaCode Export Preview</h3>
                <div class="code-block" id="exportCode"></div>
            </div>
        </div>
    </div>

    <script>
        let currentImage = null;
        let gridData = [];
        let selectedCell = null;
        let exportData = null;
        let gridSize = 4;
        let colorTolerance = 15;
        let showOverlay = true;
        let gridMode = 'interactive'; // Start with interactive mode

        // Demo image - same as React version
        const demoImageSVG = `
            <svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <radialGradient id="sky" cx="50%" cy="30%">
                        <stop offset="0%" style="stop-color:#87CEEB"/>
                        <stop offset="100%" style="stop-color:#4682B4"/>
                    </radialGradient>
                    <linearGradient id="mountain" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#8B7D6B"/>
                        <stop offset="100%" style="stop-color:#5D4E37"/>
                    </linearGradient>
                    <linearGradient id="grass" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#90EE90"/>
                        <stop offset="100%" style="stop-color:#228B22"/>
                    </linearGradient>
                </defs>
                
                <!-- Sky -->
                <rect width="800" height="400" fill="url(#sky)"/>
                
                <!-- Mountains -->
                <polygon points="0,300 200,150 400,200 600,100 800,180 800,400 0,400" fill="url(#mountain)"/>
                
                <!-- Foreground hills -->
                <ellipse cx="150" cy="380" rx="120" ry="80" fill="#6B8E23"/>
                <ellipse cx="650" cy="390" rx="150" ry="70" fill="#556B2F"/>
                
                <!-- Grass -->
                <rect y="450" width="800" height="150" fill="url(#grass)"/>
                
                <!-- Trees -->
                <circle cx="100" cy="420" r="30" fill="#228B22"/>
                <rect x="95" y="420" width="10" height="40" fill="#8B4513"/>
                
                <circle cx="300" cy="400" r="25" fill="#32CD32"/>
                <rect x="295" y="400" width="10" height="35" fill="#8B4513"/>
                
                <circle cx="500" cy="430" r="20" fill="#228B22"/>
                <rect x="495" y="430" width="10" height="30" fill="#8B4513"/>
                
                <!-- Clouds -->
                <ellipse cx="200" cy="100" rx="40" ry="20" fill="white" opacity="0.8"/>
                <ellipse cx="220" cy="95" rx="35" ry="18" fill="white" opacity="0.8"/>
                <ellipse cx="600" cy="120" rx="50" ry="25" fill="white" opacity="0.7"/>
                <ellipse cx="625" cy="115" rx="40" ry="20" fill="white" opacity="0.7"/>
            </svg>
        `;

        // Initialize with demo image
        window.addEventListener('load', () => {
            loadDemoImage();
        });

        function loadDemoImage() {
            const img = new Image();
            img.onload = () => {
                currentImage = img;
                processImage(img);
            };
            img.src = 'data:image/svg+xml;base64,' + btoa(demoImageSVG);
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            showLoading(true);
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    currentImage = img;
                    processImage(img);
                    showLoading(false);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('canvasContainer').style.display = show ? 'none' : 'block';
        }

        function getAverageColor(imageData, x, y, width, height) {
            const data = imageData.data;
            let r = 0, g = 0, b = 0, count = 0;
            
            for (let py = y; py < y + height; py++) {
                for (let px = x; px < x + width; px++) {
                    const i = (py * imageData.width + px) * 4;
                    if (i < data.length) {
                        r += data[i];
                        g += data[i + 1];
                        b += data[i + 2];
                        count++;
                    }
                }
            }
            
            if (count === 0) return { r: 0, g: 0, b: 0, hex: '#000000' };
            
            r = Math.round(r / count);
            g = Math.round(g / count);
            b = Math.round(b / count);
            
            const hex = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
            
            return { r, g, b, hex };
        }

        function processImage(img) {
            if (!img) return;
            
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 800;
            canvas.height = 600;
            
            ctx.drawImage(img, 0, 0, 800, 600);
            const imageData = ctx.getImageData(0, 0, 800, 600);
            
            const cellWidth = 800 / gridSize;
            const cellHeight = 600 / gridSize;
            const newGridData = [];
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const x = col * cellWidth;
                    const y = row * cellHeight;
                    
                    const color = getAverageColor(imageData, Math.floor(x), Math.floor(y), Math.floor(cellWidth), Math.floor(cellHeight));
                    
                    const cell = {
                        id: `cell_${row}_${col}`,
                        position: { row, col },
                        bounds: { 
                            x: Math.floor(x), 
                            y: Math.floor(y), 
                            width: Math.floor(cellWidth), 
                            height: Math.floor(cellHeight) 
                        },
                        primaryColor: color,
                        interactiveZone: true,
                        metadata: {
                            dominantColor: color.hex,
                            brightness: (color.r * 0.299 + color.g * 0.587 + color.b * 0.114) / 255,
                            contrast: color.r + color.g + color.b > 384 ? 'dark' : 'light'
                        }
                    };
                    
                    newGridData.push(cell);
                }
            }
            
            gridData = newGridData;
            generateExportData(newGridData, img);
            updatePalette();
            renderOverlay();
            updateStats();
        }

        function generateExportData(grid, img) {
            const chromaCodeData = {
                version: "1.0",
                creator: "ChromaCode‚Ñ¢ by Edna N.",
                timestamp: new Date().toISOString(),
                image: {
                    width: 800,
                    height: 600,
                    originalSrc: img.src.substring(0, 100) + "..."
                },
                grid: {
                    size: gridSize,
                    tolerance: colorTolerance,
                    cells: grid.length
                },
                zones: grid.map(cell => ({
                    id: cell.id,
                    position: cell.position,
                    bounds: cell.bounds,
                    color: cell.primaryColor,
                    metadata: cell.metadata,
                    interactive: true,
                    actions: {
                        hover: `backdrop-blur-sm bg-${cell.primaryColor.hex}/20`,
                        click: "openPanel",
                        theme: cell.primaryColor.hex
                    }
                })),
                palette: [...new Set(grid.map(cell => cell.primaryColor.hex))],
                usage: {
                    framework: "Any (React, Vue, Vanilla JS)",
                    implementation: "Use zones array for interactive overlays",
                    preservation: "Original image stays pixel-perfect as background"
                }
            };
            
            exportData = chromaCodeData;
            document.getElementById('exportBtn').disabled = false;
            
            // Update export preview
            document.getElementById('exportCode').textContent = JSON.stringify(chromaCodeData, null, 2);
            document.getElementById('exportPreview').style.display = 'block';
        }

        function updatePalette() {
            const paletteGrid = document.getElementById('paletteGrid');
            const uniqueColors = [...new Set(gridData.map(cell => cell.primaryColor?.hex))].filter(Boolean);
            
            paletteGrid.innerHTML = '';
            
            uniqueColors.forEach(hex => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = hex;
                swatch.innerHTML = `<div class="color-tooltip">${hex}</div>`;
                paletteGrid.appendChild(swatch);
            });
        }

        function renderOverlay() {
            const overlay = document.getElementById('overlay');
            overlay.innerHTML = '';
            
            if (!showOverlay) return;
            
            gridData.forEach(cell => {
                const cellDiv = document.createElement('div');
                cellDiv.className = `grid-cell ${gridMode}`;
                cellDiv.style.left = `${(cell.bounds.x / 800) * 100}%`;
                cellDiv.style.top = `${(cell.bounds.y / 600) * 100}%`;
                cellDiv.style.width = `${(cell.bounds.width / 800) * 100}%`;
                cellDiv.style.height = `${(cell.bounds.height / 600) * 100}%`;
                
                if (gridMode === 'interactive') {
                    cellDiv.innerHTML = `
                        <div class="cell-indicator" style="background-color: ${cell.primaryColor.hex}"></div>
                        <div class="cell-coords">${cell.position.row},${cell.position.col}</div>
                    `;
                    cellDiv.onclick = () => selectCell(cell);
                }
                
                overlay.appendChild(cellDiv);
            });
            
            // Update UI based on mode
            updateModeUI();
        }

        function selectCell(cell) {
            selectedCell = cell;
            
            const cellInfoCard = document.getElementById('cellInfoCard');
            const cellInfo = document.getElementById('cellInfo');
            
            cellInfoCard.style.display = 'block';
            
            cellInfo.innerHTML = `
                <div class="info-row">
                    <strong>ID:</strong>
                    <span>${cell.id}</span>
                </div>
                <div class="info-row">
                    <strong>Position:</strong>
                    <span>Row ${cell.position.row}, Col ${cell.position.col}</span>
                </div>
                <div class="info-row">
                    <strong>Color:</strong>
                    <span>${cell.primaryColor.hex}</span>
                </div>
                <div class="info-row">
                    <strong>Brightness:</strong>
                    <span>${(cell.metadata.brightness * 100).toFixed(1)}%</span>
                </div>
                <div class="info-row">
                    <strong>Contrast:</strong>
                    <span>${cell.metadata.contrast}</span>
                </div>
            `;
        }

        function updateStats() {
            const totalCells = gridData.length;
            const uniqueColors = new Set(gridData.map(cell => cell.primaryColor.hex)).size;
            
            document.getElementById('canvasStats').textContent = 
                `"${totalCells} interactive zones mapped ‚Ä¢ ${uniqueColors} unique colors ‚Ä¢ Original image preserved ‚Ä¢ Ready for export"`;
        }

        function updateGridSize() {
            gridSize = parseInt(document.getElementById('gridSize').value);
            document.getElementById('gridSizeLabel').textContent = `${gridSize}√ó${gridSize}`;
            
            if (currentImage) {
                processImage(currentImage);
            }
        }

        function updateTolerance() {
            colorTolerance = parseInt(document.getElementById('colorTolerance').value);
            document.getElementById('toleranceLabel').textContent = `${colorTolerance}%`;
            
            if (currentImage) {
                processImage(currentImage);
            }
        }

        function toggleOverlay() {
            showOverlay = document.getElementById('showOverlay').checked;
            renderOverlay();
        }

        function generateBackgroundCode() {
            if (!currentImage || !gridData.length) return null;

            const css = `/* ChromaCode Static Background Grid */
.chromacode-background {
    position: relative;
    background-image: url('your-image.jpg'); /* Replace with your image */
    background-size: cover;
    background-position: center;
    width: 100%;
    height: 400px; /* Adjust as needed */
}

.chromacode-grid {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: grid;
    grid-template-columns: repeat(${gridSize}, 1fr);
    grid-template-rows: repeat(${gridSize}, 1fr);
    gap: 1px;
    pointer-events: none;
}

.chromacode-cell {
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(1px);
    transition: all 0.3s ease;
}

/* Optional: Make grid interactive */
.chromacode-grid.interactive {
    pointer-events: all;
}

.chromacode-grid.interactive .chromacode-cell {
    cursor: pointer;
}

.chromacode-grid.interactive .chromacode-cell:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.5);
}`;

            const html = `<!-- ChromaCode Static Background Grid -->
<div class="chromacode-background">
    <div class="chromacode-grid">
        ${Array(gridSize * gridSize).fill(0).map((_, i) => 
            `        <div class="chromacode-cell" data-cell="${Math.floor(i / gridSize)}-${i % gridSize}"></div>`
        ).join('\n')}
    </div>
</div>`;

            const javascript = `// ChromaCode - Minimal JavaScript for interactions (optional)
document.addEventListener('DOMContentLoaded', () => {
    const grid = document.querySelector('.chromacode-grid');
    const cells = document.querySelectorAll('.chromacode-cell');
    
    // Make grid interactive (optional)
    grid.classList.add('interactive');
    
    cells.forEach((cell, index) => {
        const row = Math.floor(index / ${gridSize});
        const col = index % ${gridSize};
        
        cell.addEventListener('click', () => {
            console.log(\`Clicked cell: row \${row}, col \${col}\`);
            // Add your custom logic here
        });
    });
});`;

            const react = `// ChromaCode React Component - Clean & Lightweight
import React from 'react';

const ChromaCodeBackground = ({ 
    imageUrl = 'your-image.jpg',
    gridSize = ${gridSize},
    interactive = false,
    onCellClick = null
}) => {
    const handleCellClick = (row, col) => {
        console.log(\`Clicked cell: row \${row}, col \${col}\`);
        if (onCellClick) onCellClick(row, col);
    };
    
    return (
        <div 
            style={{
                position: 'relative',
                backgroundImage: \`url(\${imageUrl})\`,
                backgroundSize: 'cover',
                backgroundPosition: 'center',
                width: '100%',
                height: '400px'
            }}
        >
            <div 
                style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    width: '100%',
                    height: '100%',
                    display: 'grid',
                    gridTemplateColumns: \`repeat(\${gridSize}, 1fr)\`,
                    gridTemplateRows: \`repeat(\${gridSize}, 1fr)\`,
                    gap: '1px',
                    pointerEvents: interactive ? 'all' : 'none'
                }}
            >
                {Array(gridSize * gridSize).fill(0).map((_, index) => {
                    const row = Math.floor(index / gridSize);
                    const col = index % gridSize;
                    return (
                        <div
                            key={index}
                            style={{
                                border: '1px solid rgba(255, 255, 255, 0.2)',
                                backdropFilter: 'blur(1px)',
                                cursor: interactive ? 'pointer' : 'default',
                                transition: 'all 0.3s ease'
                            }}
                            onClick={() => interactive && handleCellClick(row, col)}
                        />
                    );
                })}
            </div>
        </div>
    );
};

export default ChromaCodeBackground;`;

            return {
                css,
                html,
                javascript,
                react,
                usage: `
# ChromaCode Static Background - Lightweight Export

## File Size: ~2KB (instead of 8MB!)

## Quick Setup
1. Replace 'your-image.jpg' in CSS with your actual image path
2. Copy CSS to your stylesheet
3. Copy HTML where you want the grid
4. Optional: Add JavaScript for basic interactions

## What's Included
- Clean CSS grid overlay
- Minimal HTML structure  
- Optional lightweight JavaScript
- Production-ready React component
- No embedded image data or heavy metadata

## Customization
- Grid size: ${gridSize}x${gridSize} (change in CSS grid-template)
- Border style: Modify .chromacode-cell border
- Hover effects: Add .interactive class to grid
- Interactions: Use the optional JavaScript

## Perfect For
- Landing page backgrounds
- Section dividers
- Image overlays
- Layout structure
- Design systems

Generated by ChromaCode‚Ñ¢ - Static Background Mode
`
            };
        }

        function setMode(mode) {
            gridMode = mode;
            
            // Update button states
            document.getElementById('staticBtn').classList.toggle('active', mode === 'background');
            document.getElementById('interactiveBtn').classList.toggle('active', mode === 'interactive');
            
            renderOverlay();
        }

        function updateModeUI() {
            const paletteCard = document.getElementById('paletteCard');
            const cellInfoCard = document.getElementById('cellInfoCard');
            const exportBtn = document.getElementById('exportBtn');
            const exportBtnText = document.getElementById('exportBtnText');
            const exportPreview = document.getElementById('exportPreview');
            const toleranceControl = document.getElementById('toleranceControl');
            
            if (gridMode === 'background') {
                // Keep palette visible but hide tolerance and cell info
                toleranceControl.style.display = 'none';
                exportBtn.disabled = false;
                exportBtnText.textContent = 'Export CSS/HTML/JS';
                exportPreview.style.display = 'none';
                
                // Hide cell info when in background mode
                cellInfoCard.style.display = 'none';
                
                document.getElementById('canvasStats').textContent = 
                    `"${gridData.length} grid cells ‚Ä¢ Clean background overlay ‚Ä¢ Perfect for UI layouts"`;
            } else {
                // Show all interactive features
                paletteCard.style.display = 'block';
                toleranceControl.style.display = 'block';
                exportBtn.disabled = !exportData;
                exportBtnText.textContent = 'Export .chromacode.json';
                exportPreview.style.display = exportData ? 'block' : 'none';
                updateStats();
            }
        }

        function downloadExport() {
            if (gridMode === 'background') {
                const backgroundCode = generateBackgroundCode();
                if (!backgroundCode) return;
                
                // Create a comprehensive file with all code types
                const content = `${backgroundCode.usage}

/* ========== CSS ========== */
${backgroundCode.css}

/* ========== HTML ========== */
${backgroundCode.html}

/* ========== JAVASCRIPT ========== */
${backgroundCode.javascript}

/* ========== REACT COMPONENT ========== */
${backgroundCode.react}
`;
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'chromacode-background.txt';
                a.click();
                URL.revokeObjectURL(url);
            } else {
                downloadChromaCode();
            }
        }

        function downloadChromaCode() {
            if (!exportData) return;
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {
                type: 'application/json'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chromacode.json';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
